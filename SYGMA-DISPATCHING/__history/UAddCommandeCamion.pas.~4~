unit UAddCommandeCamion;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.FMTBcd, Data.DB, Data.SqlExpr,
  frxClass, frxDBSet, Vcl.StdCtrls, Vcl.ExtCtrls;

type
  TfrmAddCommandeCamion = class(TForm)
    Bevel1: TBevel;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    Label5: TLabel;
    Label6: TLabel;
    edCommande: TEdit;
    edDate: TEdit;
    edChargement: TEdit;
    edVéhicule: TEdit;
    edMontant: TEdit;
    Button1: TButton;
    Button2: TButton;
    edPiece: TEdit;
    frxQComCam: TfrxReport;
    frxDBQComCam: TfrxDBDataset;
    QComCam: TSQLQuery;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
  private
    { Déclarations privées }
  public
    { Déclarations publiques }
  end;

var
  frmAddCommandeCamion: TfrmAddCommandeCamion;

implementation

{$R *.dfm}

uses records, UDM;

procedure TfrmAddCommandeCamion.Button1Click(Sender: TObject);
var
  ComCam : TCommandeCamion;
  sql,
  SqlUpChg : string;

  mVehicule,mMontant: TfrxMemoView;
  Component: TfrxComponent;
begin
if Trim(edChargement.Text)<>'' then
  begin
  with ComCam do
    begin
      Nnum_comc := StrToInt(edCommande.Text);
      Sdate_com:=QuotedStr(FormatDateTime('yyyy-mm-dd',Now));
      Nchargement := StrToInt(edChargement.Text);
      Spiece := QuotedStr(edPiece.Text);
      Svehicule := QuotedStr(edVéhicule.Text);
      Rmontant := StrToFloat(edMontant.Text);
      Rmontant_p:=0;
      Rmontant_r:=StrToFloat(edMontant.Text);
      Nstatut_cmd := 0;
    end;
    if MessageDlg('Confirmez-vous la création de cette commande ?',mtConfirmation,[mbYes,mbNo],0) = mrYes then
      begin
        dm.InsertCommandeCam(ComCam);

        SqlUpChg := 'Update tb_vte_chargveh set '
                    +'statut_com = 1 '
                    +' where numCharg = '+edChargement.Text;
        dm.UpdateTable(SqlUpChg);

        sql := 'select * from tb_vte_chargvehd ch, tb_commande_camion c '
                +' where ch.numCharg = '+QuotedStr(edChargement.Text)
                +' and c.num_comc = '+QuotedStr(edCommande.Text)
                +' and ch.numCharg = c.chargement';

        QComCam.SQL.Clear;
        QComCam.SQL.Add(sql);
        QComCam.Open;

        frxQComCam.ShowReport();

        Button2.Click;
      end;
  end else
  MessageDlg('Tous les champs sont obligatoires', mtError,[mbOK],0);
end;

procedure TfrmAddCommandeCamion.Button2Click(Sender: TObject);
begin
  edChargement.Clear;
  edPiece.Clear;
  edVéhicule.Clear;
  edMontant.Clear;

  FormShow(Sender);

end;

end.
